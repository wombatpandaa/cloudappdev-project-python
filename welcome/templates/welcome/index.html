<head>
  <script type="module">

  // import kaboom lib
  import kaboom from "https://unpkg.com/kaboom@next/dist/kaboom.mjs";

  // initialize kaboom context
  const FLOOR_HEIGHT = 48;
  const JUMP_FORCE = 800;
  const SPEED = 480;

  // initialize context
  kaboom();

  // load assets
  //loadSprite("link", "linktrue.png");
  //loadSprite("cake", "cake30.png")
  loadBean();

  scene("game", () => {

      // define gravity
      gravity(2400);

      // add a game object to screen
      const player = add([
          // list of components
          sprite("bean"),
          pos(80, 40),
          area(),
          body(),
      ]);

      // floor
      add([
          rect(width(), FLOOR_HEIGHT),
          outline(4),
          pos(0, height()),
          origin("botleft"),
          area(),
          solid(),
          color(127, 200, 255),
      ]);

      function jump() {
          if (player.grounded()) {
              player.jump(JUMP_FORCE);
          }
      }

      // jump when user press space
      keyPress("space", jump);
      mouseClick(jump);

      function spawnCake() {

          // add cake obj
          add([
      			//sprite("cake"),
      			area(),
      			outline(4),
      			pos(width(), height() - FLOOR_HEIGHT),
      			origin('botleft'),
      			move(LEFT, SPEED),
      			"movecake"
      		]);

          // wait a random amount of time to spawn next cake
          wait(rand(0.8, 2.0), spawnCake);

      }

  	  spawnCake();

      // lose if player collides with any game obj with tag "movecake"
      player.collides("movecake", () => {
          // go to "win" scene and pass the score
          go("win", score);
          addKaboom(player.pos);
      });

      // keep track of score
      let score = 0;

      const scoreLabel = add([
          text(score),
          pos(24, 24),
      ]);

      // increment score every frame
      action(() => {
          score++;
          scoreLabel.text = score;
      });

  });

  scene("win", (score) => {

      add([
          sprite("bean"),
          pos(width() / 2, height() / 2 - 160),
          scale(2),
          origin("center"),
      ]);

      // display score
      add([
          text("Score: " + score),
          pos(width() / 2, height() / 2 - 30),
          scale(2),
          origin("center"),
      ]);

      add([
        text("Happy birthday dad!!"),
        pos(width() / 2, height() / 2 + 100),
        scale(2),
        origin("center"),
      ])

      add([
        text("Now go eat cake :P"),
        pos(width() /2, height() /2 + 250),
        scale(2),
        origin("center"),
      ])

      // go back to game with space is pressed
      keyPress("space", () => go("game"));
      mouseClick(() => go("game"));

  });

  go("game");

  </script>
</head>

<body>

</body>
